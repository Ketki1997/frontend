
## PROJECT: AS26:
## Username: Azlogics
## Password: Azlogics@2022
## Username: aztaxcpc
## Email: ram@azlogics.com
## AppPassword: ATBBXuun4fWwyHhk9755msvVPUBQ4EB44FEF 

## Host Name:-152.67.23.134

## Step-1 Putty

```
SSh -> Auth -> Credentials -> Upload oracel ppk "Oracel_Ubuntu" 
---> connection to server completed 

```
## Step-2 BackEnd 
```
Root:Ubuntu --> 
sudo su  

ls-a

cd/home/ubuntu/26as

cd/4050_auth

git pull

npm i 

npm run build
 
```
## step-3 PM2

```
pm2 start
pm2 reload
pm2 list

```
## step-4 FrontEnd 
```
cd/var/www/

ls -a

cd frontend

git pull

npm i 

npm run build

```




#### .env change 

```
nano .env

ctrl + x 

y

Enter

```




#### Domain/Subdomain attach to nginx

    creating your folder for host site 26as.figmentglobal.com

```
    sudo touch /etc/nginx/sites-available/26as.figmentglobal.com.conf

    sudo nano /etc/nginx/sites-available/26as.figmentglobal.com.conf

```
    copy below code

# 26as
```
    server {
        listen 80;
        listen [::]:80;

        root /var/www/frontend/build;
        index index.html index.htm index.nginx-debian.html;

        server_name 26as.figmentglobal.com;

        location / {
            try_files $uri $uri/ /index.html =404;
        }
    }

```

    Validate our Configuration and Start Nginx

```
    sudo nginx -t

    sudo ln -s /etc/nginx/sites-available/26as.figmentglobal.com.conf /etc/nginx/sites-enabled/26as.figmentglobal.com.conf

   ## sudo rm -rf /etc/nginx/sites-enabled/default

    sudo systemctl start nginx

    sudo systemctl reload nginx

    sudo systemctl status nginx

```

## STEP 7 : SSL attach to nginx

    Note

```
    to setup ssl enable port 443 from security keys

```

    Installing Certbot

```
    sudo apt install certbot python3-certbot-nginx

    sudo nginx -t

    sudo systemctl reload nginx

```

    Obtaining an SSL Certificate

```

    sudo certbot --nginx -d 26as.figmentglobal.com

```

    Note if you want to run nodejs express as backend then need to add nginx conf as follow

```

################################################
##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# https://www.nginx.com/resources/wiki/start/
# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
# https://wiki.debian.org/Nginx/DirectoryStructure
#
# In most cases, administrators will remove this file from sites-enabled/ and
# leave it as reference inside of sites-available where it will continue to be
# updated by the nginx packaging team.
#
# This file will automatically load configuration files provided by other
# applications, such as Drupal or Wordpress. These applications will be made
# available underneath a path with that package name, such as /drupal8.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

upstream websocketserver {
    server localhost:4100; # appserver_ip:ws_port
}





server {
        listen 80 default_server;
        listen [::]:80 default_server;

        # SSL configuration
        #
        # listen 443 ssl default_server;
        # listen [::]:443 ssl default_server;
        #
        # Note: You should disable gzip for SSL traffic.
        # See: https://bugs.debian.org/773332
        #
        # Read up on ssl_ciphers to ensure a secure configuration.
        # See: https://bugs.debian.org/765782
        #
        # Self signed certs generated by the ssl-cert package
        # Don't use them in a production server!
        #
        # include snippets/snakeoil.conf;

        # root /var/www/html;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        # For Time incresing
        proxy_connect_timeout 3600s;
        send_timeout 3600s;
        proxy_read_timeout 3600s;








        # For Frontend
        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                # try_files $uri $uri/ =404;
                root /var/www/frontend-v4/build;
                try_files $uri /index.html;
        }

        # For xlsx
        location ~* .(xlsx)$ {
                root /var/www/frontend-v4/;
        }

        # For txt || zip
        location ~* .(txt|zip)$ {
                root /home/ubuntu/taxcpc/bulk_upload/public/;
        }

        # Auth at 4050
        location /api/auth/ {
                proxy_pass http://localhost:4050/;
        }

        # Filter at 4052
        location /api/filter/ {
                proxy_pass http://localhost:4052/;
        }

        # Setting at 4051
        location /api/settings/ {
                proxy_pass http://localhost:4051/;
        }

        # Transactions at 4053
        location /api/transactions/ {
                proxy_pass http://localhost:4053/;
        }

        # Challan details at 4054
        location /api/challan-details/ {
                proxy_pass http://localhost:4054/;
        }

        # TDS Return at 4055
        location /api/tds-return/ {
                proxy_pass http://localhost:4055/;
        }

        # Allocation at 4056
        location /api/allocation/ {
                proxy_pass http://localhost:4056/;
        }

        # Request Downloads at 4057
        location /api/downloads/{
                proxy_pass http://localhost:4057/;
        }

        # Validation Process at 4058
        location /api/validations/ {
                proxy_pass http://localhost:4058/;
        }

        # Bulk Upload at 4010
        location /api/bulk-upload/ {
                proxy_pass http://localhost:4010/;
        }

        location /websocket {
                proxy_pass http://websocketserver;
                proxy_set_header Upgrade $http_upgrade;
                proxy_set_header Connection $connection_upgrade;
                proxy_http_version 1.1;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header Host $http_host;
                proxy_intercept_errors on;
                proxy_redirect off;
                proxy_cache_bypass $http_upgrade;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-NginX-Proxy true;
                proxy_ssl_session_reuse off;
        }







